<!DOCTYPE html>

<html>

<head>
  <meta charset="utf-8" />
  <title>ГИС-технологии</title>
  <link href="css/style.css" rel="stylesheet">
</head>

<body>
  <header>
    <img src="img/gis-icon.jpg" width="64px" height="64px">
    <h1>ГИС-технологии</h1>
  </header>

  <article>
    <p>Написанные програмы высылать на почту преподавателю. В письме указать ФИО отправителя, группу и номер практической работы.</p>
  </article>

  <details>
    <summary>
      <h3>Практическая работа № 3. Пересечение обектов слоя</h3>
    </summary>

    <p>Используя API QGIS, написать программу, реализующую поиск и выделение всех объектов активного слоя, которые пересекаются между собой.</p>
    <p>Провести тестирование программы при различных сценариях.</p>
    <p>Написать комментарии к коду. Описать работу программы.</p>
    <p class="update">Встроить код в плагин PlanCreator. Добавить диалоговое окно, которое подсказывает на каком уровне есть пересечения.</p>
    
    <p class="part">Решение</p>
    <pre>
layer = qgis.utils.iface.activeLayer()  # enter in active(select) layer
features = layer.getFeatures()          # getting all features from layer
selected = []
for item in features:
    features = layer.getFeatures()      # need for script work
#    print(item.id())
    for count in features:
#        print("*")
#        print(item.id())
#        print(count.id())
        if item.id() != count.id():
            geom1 = item.geometry()     # need for check geometry 
            geom2 = count.geometry()	# to work without errors and for check intersects
#            print("*") check for intersects
#            print(item.id())
#            print(count.id())
#            print(geom1.intersects(geom2))
#            print("*")
            if geom1.type() == QGis.Polygon and geom2.type() == QGis.Polygon and geom1.intersects(geom2):
                selected.append(item.id())   # add intersected features
layer.setSelectedFeatures(selected)          # select features
    </pre>
  </details>

  <details>
    <summary>
      <h3>Практическая работа № 4. Невалидные объекты</h3>
    </summary>

    <p>Используя API QGIS, написать программу, реализующую поиск и выделение всех объектов слоя doors, которые: </p>
    <ol>
      <li>пересекаются между собой в пределах слоя (цвет - желтый);</li>
      <li>включают более 5 точек (цвет - синий);</li>
      <li>не пересекают слой rooms группы этажа (цвет - черный);</li>
    </ol>
    <p>Провести тестирование программы при различных сценариях.</p>
    <p>Написать комментарии к коду. Описать работу программы.</p>
  </details>

  <details>
    <summary>
      <h3>Практическая работа № 5. Обмен данными с внешними программами</h3>
    </summary>

    <p>Используя API QGIS, написать программу, реализующую вызов внешней программы с передачей ей некоторых параметров и получение, с последующей обработкой, ответа.</p>
    <p>Например, устроить обмен с программой на Python, которая запускается из QGIS, формирует строку "Hello World" и отправляет ее в QGIS (можно отображать с помощью диалогового окна или вывести в консоль).</p>
  </details>
  
  <details>
    <summary>
      <h3>Практическая работа № 6. Поиск объектов превышающих размеры</h3>
    </summary>

    <p>Используя API QGIS, написать программу, которая выделяет все помещения, соотношения сторон которых больше 1/3.</p>
    <p class="update">Встроить код в плагин PlanCreator. Добавить диалоговое окно, которое подсказывает на каком уровне есть объекты, неудовлетворяющие условиям.</p>
    <p class="part">Решение</p>
    <pre>
layer = qgis.utils.iface.activeLayer()  # enter in active(select) layer
features = layer.getFeatures()          # getting all features from layer
selected = []
for item in features:
    features = layer.getFeatures()      # need for script work
    geom1 = item.geometry()             # need for check geometry
    if geom1.type() == QGis.Polygon:
        for count in features:
            x = geom1.asPolygon()

            length1 = (x[0][1][0] - x[0][4][0])**2 + (x[0][1][1] - x[0][4][1])**2   #side length between points 4 and 1
            length2 = (x[0][2][0] - x[0][1][0])**2 + (x[0][2][1] - x[0][1][1])**2   #side length between points 1 and 2
            length3 = (x[0][3][0] - x[0][2][0])**2 + (x[0][3][1] - x[0][2][1])**2   #side length between points 2 and 3
            length4 = (x[0][4][0] - x[0][3][0])**2 + (x[0][4][1] - x[0][3][1])**2   #side length between points 3 and 4
    
            average1 = (length1 + length3) / 2  #average length of opposite sides
            average2 = (length2 + length4) / 2
    
        if (average2**0.5 / average1**0.5 > 3): #aspect ratio check
            print('&gt; 1 : 3')
            selected.append(item.id())
        else:
            print('&lt; 1 : 3')
layer.setSelectedFeatures(selected)             # select features
    </pre>
  </details>
  
  <details>
    <summary>
      <h3>Практическая работа № 7. Создание плагинов в QGIS 3</h3>
    </summary>

    <p>Портировать плагин PlanCreator в QGIS 3.x и протестировать его работу.</p>
    <p class="part">Этапы работы:</p>
    <ul>
      <li>установить QGIS 3 и создать плагин "Hello world";</li>
      <li>реализовать функцию "Начать новоый проект BuildingJSON";</li>
      <li>реализовать функцию "Добавить новый слой";</li>
      <li>реализовать функцию "Создать JSON".</li>
    </ul>
  </details>  

  <section class="sfooter">
    <div class="sfooter-item">
      <h3>Где почитать</h3>
      <ul class="sfooter-links">
        <li><a href="https://www.python.org">python</a> </li>
        <li><a href="https://docs.qgis.org/2.18/en/docs/pyqgis_developer_cookbook/vector.html">Using Vector Layers</a></li>
      </ul>
    </div>
    <div class="sfooter-item">
      <h3>Где скачать</h3>
      <ul class="sfooter-links">
        <li><a href="https://qgis.org/downloads/">QGIS 2.18</a></li>
      </ul>
    </div>
  </section>
</body>

</html>
